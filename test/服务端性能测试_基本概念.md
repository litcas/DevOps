- [服务端性能测试：基本概念](#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%EF%BC%9A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5)
	- [1. 基本概念](#1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5)
	- [2. 性能指标](#2-%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87)
	- [3. Refer Links](#3-refer-links)

# 服务端性能测试：基本概念

## 1. 基本概念

总体来说，系统性能就是两个事：
- Throughput ，吞吐量。也就是每秒钟可以处理的请求数，任务数。
- Latency， 系统延迟。也就是系统在处理一个请求或一个任务时的延迟。

一般来说，一个系统的性能受到这两个条件的约束，缺一不可。比如，我的系统可以顶得住一百万的并发，但是系统的延迟是 2 分钟以上，那么，这个一百万的负载毫无意义。系统延迟很短，但是吞吐量很低，同样没有意义。所以，一个好的系统的性能测试必然受到这两个条件的同时作用。 有经验的朋友一定知道，这两个东西的一些关系：
- Throughput 越大，Latency 会越差。因为请求量过大，系统太繁忙，所以响应速度自然会低。
- Latency 越好，能支持的 Throughput 就会越高。因为 Latency 短说明处理速度快，于是就可以处理更多的请求。

## 2. 性能指标

- 【吞吐量】 固定时间间隔内的处理完毕事务个数。通常是 1 秒内处理完毕的请求个数，单位：事务 / 秒（tps）。

- 【平均吞吐量】一段时间内吞吐量的平均值。无法体现吞吐量的瞬间变化。

- 【峰值吞吐量】一段时间内吞吐量的最大值。是用来评估系统容量的重要指标之一。

- 【最低吞吐量】一段时间内吞吐量的最小值。如果最小值接近 0，说明系统有“卡”的现象。

- 【70% 的吞吐量集中区间】通过统计 15% 和 85% 的吞吐量边界值，计算出 70% 的吞吐量集中区间。区间越集中，吞吐量越稳定。

- 【响应时间】一次事务的处理时间。通常指从一个请求发出，到服务器进行处理后返回，再到接收完毕应答数据的时间间隔，单位：毫秒。

- 【平均响应时间】 一段时间内响应时间的平均值。无法体现响应时间的波动情况。

- 【中间响应时间】一段时间内响应时间的中间值，50% 响应时间，有一半的服务器响应时间低于该值而另一半高于该值。

- 【90% 响应时间】一段时间内 90% 的事务响应时间比此数值要小。反应总体响应速度，和高于该值的 10% 超时率。是用来评估系统容量的重要指标之一。

- 【最小响应时间】响应时间的最小值。反映服务最快处理能力。

- 【最大响应时间】响应时间的最大值。反映服务器最慢处理能力。

- 【CPU 占用率】1-CPU 空闲率，表示 CPU 被使用情况，反映了系统资源利用情况。

- PV (Page View)

- QPS (Query Per Second) / QPM (Query Per Minute): 应用服务器每秒 / 分钟能处理的查询次数。

	> QPS = 总请求数 / 请求时间

- 峰值 QPS: 每天 80% 的访问集中在 20% 的时间里，这 20% 时间叫做峰值时间，这段时间内的 QPS 称为峰值 QPS。

	> 峰值 QPS = ( 总 PV 数 * 80% ) / ( 每天秒数 * 20% )

	问：每天 300w PV 的在单台机器上，这台机器需要多少 QPS？如果一台机器的 QPS 是 58，需要几台机器来支持？
	
	答：
	- ( 3000000 * 0.8 ) / (86400 * 0.2 ) = 139 (QPS)
	- 139 / 58 = 3 台

- RPS (Requests Per Second)

- TPS (Transactions Per Second): 每秒传输的事物处理个数，即服务器每秒处理的事务数。TPS 包括一条消息入和一条消息出，加上一次用户数据库访问。

- TP 值（Top Percentile），[在大多数情况下，TP 值比 AGV 值更加有价值](https://www.dynatrace.com/news/blog/why-averages-suck-and-percentiles-are-great/)

	- TP99：即 Top Percentile 99，满足 99% 的网络请求所需要的最低耗时。

		如：有四次请求耗时分别为：10ms，1000ms，100ms，2ms。则 4 次请求中，99% 的请求数为 4*0.99，进位取整也就是 4 次，满足这全部 4 次请求的的最低耗时为 1000ms，也就是 TP99 的答案是 1000ms。

	- TP999：即 Top Percentile 99.9，满足 99.9% 的网络请求所需要的最低耗时。

## 3. Refer Links

[关于服务性能优化思考](https://blog.csdn.net/Weiguang_123/article/details/60633276)

[PV、TPS、QPS 是怎么计算出来的？](https://www.zhihu.com/question/21556347)
